# Arquitetura - Taskchampion Sync Server

DocumentaÃ§Ã£o visual da arquitetura e fluxo de dados do sistema de sincronizaÃ§Ã£o.

## ğŸ—ï¸ VisÃ£o Geral do Sistema

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Rede Local (192.168.x.x)                    â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Desktop    â”‚         â”‚  Orange Pi   â”‚         â”‚   Laptop     â”‚ â”‚
â”‚  â”‚              â”‚         â”‚   Zero 2     â”‚         â”‚              â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚         â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚         â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚ â”‚Taskwarriorâ”‚â—„â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”¤  Sync    â”‚â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ â”‚Taskwarriorâ”‚ â”‚ â”‚
â”‚  â”‚ â”‚  Client  â”‚ â”‚  HTTP   â”‚ â”‚  Server  â”‚ â”‚  HTTP   â”‚ â”‚  Client  â”‚ â”‚ â”‚
â”‚  â”‚ â”‚          â”‚ â”‚  8080   â”‚ â”‚  (8080)  â”‚ â”‚  8080   â”‚ â”‚          â”‚ â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚         â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚         â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚              â”‚         â”‚      â”‚       â”‚         â”‚              â”‚ â”‚
â”‚  â”‚ UUID: 1111.. â”‚         â”‚      â–¼       â”‚         â”‚ UUID: 2222.. â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                           â”‚ â”‚   Data   â”‚ â”‚                           â”‚
â”‚                           â”‚ â”‚  Store   â”‚ â”‚                           â”‚
â”‚                           â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                           â”‚
â”‚                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š Componentes do Sistema

### Servidor (Orange Pi Zero 2)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Orange Pi Zero 2                         â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              systemd (PID 1)                        â”‚    â”‚
â”‚  â”‚                                                       â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚  taskchampion-sync-server.service           â”‚   â”‚    â”‚
â”‚  â”‚  â”‚                                               â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  User: taskchampion                          â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  Group: taskchampion                         â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  Port: 8080                                  â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  Address: 0.0.0.0                            â”‚   â”‚    â”‚
â”‚  â”‚  â”‚                                               â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  taskchampion-sync-server binary    â”‚    â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â”‚                                       â”‚    â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  - Escuta HTTP na porta 8080         â”‚    â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  - Processa requisiÃ§Ãµes de sync      â”‚    â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  - Gerencia conflitos                â”‚    â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  - Persiste dados                    â”‚    â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚    â”‚
â”‚  â”‚  â”‚                    â”‚                         â”‚   â”‚    â”‚
â”‚  â”‚  â”‚                    â–¼                         â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  /var/lib/taskchampion-sync-server/ â”‚    â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â”‚                                       â”‚    â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  - data.json (tarefas)               â”‚    â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  - metadata (versÃµes, clientes)      â”‚    â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  - PermissÃµes: 750                   â”‚    â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â”‚  - Owner: taskchampion:taskchampion  â”‚    â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              Firewall (iptables)                    â”‚    â”‚
â”‚  â”‚                                                       â”‚    â”‚
â”‚  â”‚  ACCEPT: tcp dport 8080 (from anywhere)             â”‚    â”‚
â”‚  â”‚  ACCEPT: tcp dport 22 (SSH)                         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Cliente (Desktop/Laptop)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Cliente (Desktop/Laptop)                  â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              Taskwarrior 3                          â”‚    â”‚
â”‚  â”‚                                                       â”‚    â”‚
â”‚  â”‚  ConfiguraÃ§Ã£o (~/.config/task/taskrc):              â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚ sync.server.origin=http://orangepizero2:8080â”‚   â”‚    â”‚
â”‚  â”‚  â”‚ sync.server.client_id=<uuid-unico>          â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â”‚                                                       â”‚    â”‚
â”‚  â”‚  Comandos:                                           â”‚    â”‚
â”‚  â”‚  - task sync init  (primeira vez)                   â”‚    â”‚
â”‚  â”‚  - task sync       (sincronizar)                    â”‚    â”‚
â”‚  â”‚                                                       â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚  ~/.local/share/task/                       â”‚   â”‚    â”‚
â”‚  â”‚  â”‚                                               â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  - pending.data (tarefas pendentes)          â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  - completed.data (tarefas completas)        â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  - undo.data (histÃ³rico)                     â”‚   â”‚    â”‚
â”‚  â”‚  â”‚  - backlog.data (sync metadata)              â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚         ServiÃ§os Opcionais (systemd)                â”‚    â”‚
â”‚  â”‚                                                       â”‚    â”‚
â”‚  â”‚  - taskwarrior-sync.timer (sync automÃ¡tico)         â”‚    â”‚
â”‚  â”‚  - taskwarrior-backup.timer (backup diÃ¡rio)         â”‚    â”‚
â”‚  â”‚  - taskwarrior-ssh-tunnel.service (tÃºnel SSH)       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Fluxo de SincronizaÃ§Ã£o

### Primeira SincronizaÃ§Ã£o (sync init)

```
Cliente                          Servidor
  â”‚                                 â”‚
  â”‚  1. task sync init              â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
  â”‚                                 â”‚
  â”‚  2. Envia todas as tarefas      â”‚
  â”‚     locais (JSON)               â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
  â”‚                                 â”‚
  â”‚                                 â”‚  3. Armazena tarefas
  â”‚                                 â”‚     em data.json
  â”‚                                 â”‚
  â”‚  4. Confirma recebimento        â”‚
  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  â”‚                                 â”‚
  â”‚  5. Marca como sincronizado     â”‚
  â”‚                                 â”‚
```

### SincronizaÃ§Ã£o Regular (sync)

```
Cliente                          Servidor
  â”‚                                 â”‚
  â”‚  1. task sync                   â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
  â”‚                                 â”‚
  â”‚  2. Envia mudanÃ§as locais       â”‚
  â”‚     (delta desde Ãºltimo sync)   â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
  â”‚                                 â”‚
  â”‚                                 â”‚  3. Processa mudanÃ§as
  â”‚                                 â”‚     Detecta conflitos
  â”‚                                 â”‚     Atualiza data.json
  â”‚                                 â”‚
  â”‚  4. Recebe mudanÃ§as remotas     â”‚
  â”‚     (de outros clientes)        â”‚
  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  â”‚                                 â”‚
  â”‚  5. Aplica mudanÃ§as localmente  â”‚
  â”‚     Resolve conflitos           â”‚
  â”‚                                 â”‚
```

### MÃºltiplos Clientes

```
Desktop                    Servidor                    Laptop
  â”‚                           â”‚                           â”‚
  â”‚  1. task add "Tarefa A"   â”‚                           â”‚
  â”‚                           â”‚                           â”‚
  â”‚  2. task sync             â”‚                           â”‚
  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                           â”‚
  â”‚                           â”‚                           â”‚
  â”‚                           â”‚  3. Armazena "Tarefa A"   â”‚
  â”‚                           â”‚                           â”‚
  â”‚                           â”‚  4. task sync             â”‚
  â”‚                           â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚                           â”‚                           â”‚
  â”‚                           â”‚  5. Envia "Tarefa A"      â”‚
  â”‚                           â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
  â”‚                           â”‚                           â”‚
  â”‚                           â”‚                           â”‚  6. Recebe "Tarefa A"
  â”‚                           â”‚                           â”‚
```

## ğŸ” Camadas de SeguranÃ§a

### ConfiguraÃ§Ã£o PadrÃ£o (Rede Local)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Rede Local (WiFi)                       â”‚
â”‚                                                               â”‚
â”‚  Cliente â”€â”€â”€â”€â”€â”€â–º Firewall â”€â”€â”€â”€â”€â”€â–º Servidor                  â”‚
â”‚           HTTP          ACCEPT           8080                â”‚
â”‚           8080          tcp/8080                             â”‚
â”‚                                                               â”‚
â”‚  SeguranÃ§a:                                                  â”‚
â”‚  - Firewall do roteador                                     â”‚
â”‚  - Rede privada (192.168.x.x)                               â”‚
â”‚  - Sem autenticaÃ§Ã£o (confianÃ§a na rede)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Com TÃºnel SSH

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Rede NÃ£o ConfiÃ¡vel                      â”‚
â”‚                                                               â”‚
â”‚  Cliente â”€â”€â”€â”€â”€â”€â–º SSH Tunnel â”€â”€â”€â”€â”€â”€â–º Servidor                â”‚
â”‚           localhost:8080    SSH    127.0.0.1:8080           â”‚
â”‚                             (22)                             â”‚
â”‚                                                               â”‚
â”‚  SeguranÃ§a:                                                  â”‚
â”‚  - Criptografia SSH                                          â”‚
â”‚  - AutenticaÃ§Ã£o por chave                                    â”‚
â”‚  - Servidor nÃ£o exposto (127.0.0.1)                         â”‚
â”‚  - Firewall bloqueia 8080 externo                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Com VPN (Tailscale)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Internet PÃºblica                        â”‚
â”‚                                                               â”‚
â”‚  Cliente â”€â”€â”€â”€â”€â”€â–º Tailscale VPN â”€â”€â”€â”€â”€â”€â–º Servidor             â”‚
â”‚         100.x.x.1          WireGuard         100.x.x.2      â”‚
â”‚                            (encrypted)                       â”‚
â”‚                                                               â”‚
â”‚  SeguranÃ§a:                                                  â”‚
â”‚  - Criptografia WireGuard                                    â”‚
â”‚  - Rede privada virtual                                      â”‚
â”‚  - NAT traversal automÃ¡tico                                  â”‚
â”‚  - Firewall apenas na interface VPN                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Com Reverse Proxy (HTTPS)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Internet PÃºblica                        â”‚
â”‚                                                               â”‚
â”‚  Cliente â”€â”€â”€â”€â”€â”€â–º Caddy (HTTPS) â”€â”€â”€â”€â”€â”€â–º Servidor             â”‚
â”‚         sync.domain.com:443    localhost:8080               â”‚
â”‚                                                               â”‚
â”‚  SeguranÃ§a:                                                  â”‚
â”‚  - Certificado SSL/TLS (Let's Encrypt)                      â”‚
â”‚  - AutenticaÃ§Ã£o bÃ¡sica (opcional)                            â”‚
â”‚  - Rate limiting                                             â”‚
â”‚  - Logs de acesso                                            â”‚
â”‚  - Servidor nÃ£o exposto diretamente                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ’¾ Estrutura de Dados

### Servidor

```
/var/lib/taskchampion-sync-server/
â”œâ”€â”€ data.json                    # Tarefas de todos os clientes
â”‚   â””â”€â”€ [
â”‚         {
â”‚           "uuid": "abc-123",
â”‚           "description": "Tarefa exemplo",
â”‚           "status": "pending",
â”‚           "client": "ClienteX",
â”‚           ...
â”‚         }
â”‚       ]
â”œâ”€â”€ metadata/
â”‚   â”œâ”€â”€ clients.json            # Lista de clientes conectados
â”‚   â””â”€â”€ versions.json           # VersÃµes de sincronizaÃ§Ã£o
â””â”€â”€ backups/                    # Backups automÃ¡ticos (opcional)
    â”œâ”€â”€ 20260226-120000.tar.gz
    â””â”€â”€ 20260225-120000.tar.gz
```

### Cliente

```
~/.local/share/task/
â”œâ”€â”€ pending.data                # Tarefas pendentes (formato binÃ¡rio)
â”œâ”€â”€ completed.data              # Tarefas completadas
â”œâ”€â”€ undo.data                   # HistÃ³rico de undo
â”œâ”€â”€ backlog.data                # Metadata de sincronizaÃ§Ã£o
â””â”€â”€ backups/                    # Backups locais (opcional)
    â””â”€â”€ tasks-20260226.json.gz
```

## ğŸ”„ Estados de SincronizaÃ§Ã£o

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Estados PossÃ­veis                         â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚  Local   â”‚  Tarefa existe apenas no cliente              â”‚
â”‚  â”‚   Only   â”‚  AÃ§Ã£o: Enviar para servidor no prÃ³ximo sync   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚  Remote  â”‚  Tarefa existe apenas no servidor             â”‚
â”‚  â”‚   Only   â”‚  AÃ§Ã£o: Baixar no prÃ³ximo sync                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚  Synced  â”‚  Tarefa idÃªntica em cliente e servidor        â”‚
â”‚  â”‚          â”‚  AÃ§Ã£o: Nenhuma                                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚ Modified â”‚  Tarefa modificada localmente                 â”‚
â”‚  â”‚  Local   â”‚  AÃ§Ã£o: Enviar mudanÃ§as para servidor          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚ Modified â”‚  Tarefa modificada remotamente                â”‚
â”‚  â”‚  Remote  â”‚  AÃ§Ã£o: Baixar mudanÃ§as do servidor            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚ Conflict â”‚  Tarefa modificada em ambos os lados          â”‚
â”‚  â”‚          â”‚  AÃ§Ã£o: Resolver conflito (Ãºltimo vence)       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ˆ Escalabilidade

### Limites PrÃ¡ticos

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Orange Pi Zero 2                          â”‚
â”‚                                                               â”‚
â”‚  CPU: 4x Cortex-A53 @ 1.5GHz                                â”‚
â”‚  RAM: 1GB                                                    â”‚
â”‚  Storage: SD Card (limitado por I/O)                        â”‚
â”‚                                                               â”‚
â”‚  Capacidade Estimada:                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Tarefas:        ~10,000 tarefas                    â”‚   â”‚
â”‚  â”‚  Clientes:       ~10 clientes simultÃ¢neos           â”‚   â”‚
â”‚  â”‚  SincronizaÃ§Ãµes: ~100 syncs/hora                    â”‚   â”‚
â”‚  â”‚  LatÃªncia:       <100ms (rede local)                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â”‚  Gargalos:                                                   â”‚
â”‚  - I/O do SD Card (considerar SSD externo)                  â”‚
â”‚  - MemÃ³ria RAM (1GB Ã© suficiente para uso normal)           â”‚
â”‚  - Rede (100Mbps Ethernet Ã© suficiente)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ” Monitoramento

### Pontos de ObservaÃ§Ã£o

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Monitoramento                             â”‚
â”‚                                                               â”‚
â”‚  1. ServiÃ§o                                                  â”‚
â”‚     systemctl status taskchampion-sync-server               â”‚
â”‚     â”œâ”€ Active: active (running)                             â”‚
â”‚     â”œâ”€ Memory: ~20MB                                        â”‚
â”‚     â””â”€ CPU: <1%                                             â”‚
â”‚                                                               â”‚
â”‚  2. Logs                                                     â”‚
â”‚     journalctl -u taskchampion-sync-server                  â”‚
â”‚     â”œâ”€ ConexÃµes                                             â”‚
â”‚     â”œâ”€ Erros                                                â”‚
â”‚     â””â”€ Performance                                          â”‚
â”‚                                                               â”‚
â”‚  3. Rede                                                     â”‚
â”‚     ss -tlnp | grep :8080                                   â”‚
â”‚     â””â”€ ConexÃµes ativas                                      â”‚
â”‚                                                               â”‚
â”‚  4. Dados                                                    â”‚
â”‚     du -sh /var/lib/taskchampion-sync-server/              â”‚
â”‚     â””â”€ Tamanho do banco                                     â”‚
â”‚                                                               â”‚
â”‚  5. Sistema                                                  â”‚
â”‚     â”œâ”€ CPU: top                                             â”‚
â”‚     â”œâ”€ MemÃ³ria: free -h                                     â”‚
â”‚     â”œâ”€ Disco: df -h                                         â”‚
â”‚     â””â”€ Temperatura: /sys/class/thermal/thermal_zone0/temp  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ Casos de Uso

### Caso 1: Desenvolvedor Solo

```
Desktop (trabalho) â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ Servidor
                                              â†•
Laptop (casa)      â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ Servidor

- 2 dispositivos
- SincronizaÃ§Ã£o manual (task sync)
- Rede local confiÃ¡vel
- Sem backup automÃ¡tico necessÃ¡rio
```

### Caso 2: Equipe Pequena

```
Dev 1 Desktop â†â”€â”€â”€â”€â”€â”€â”€â”€â”
Dev 1 Laptop  â†â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                        â”œâ”€â”€â†’ Servidor â†â”€â”€â†’ Backup AutomÃ¡tico
Dev 2 Desktop â†â”€â”€â”€â”€â”€â”€â”€â”€â”¤
Dev 2 Laptop  â†â”€â”€â”€â”€â”€â”€â”€â”€â”˜

- 4+ dispositivos
- MÃºltiplos usuÃ¡rios (UDA client)
- SincronizaÃ§Ã£o automÃ¡tica (timer)
- Backup diÃ¡rio
- VPN ou tÃºnel SSH
```

### Caso 3: Acesso Remoto

```
Casa: Desktop â†â”€â”€â†’ VPN (Tailscale) â†â”€â”€â†’ Servidor
                                          â†•
Trabalho: Laptop â†â”€â”€â†’ VPN (Tailscale) â†â”€â”€â†’ Servidor

- Acesso de qualquer lugar
- Criptografia end-to-end
- NAT traversal automÃ¡tico
- Backup para cloud (opcional)
```

## ğŸ“š ReferÃªncias

- [MÃ³dulo NixOS](./modules/taskchampion-sync-server.nix)
- [Guia de Setup](./TASKWARRIOR-SETUP.md)
- [DocumentaÃ§Ã£o de SeguranÃ§a](./docs/taskwarrior-security.md)
- [Troubleshooting](./docs/taskwarrior-troubleshooting.md)
